
                           //\  //\  //\  //\  //\  //\  //\
                          //  \//  \//  \//  \//  \//  \//  \
                         //    _   _   _   _   _   _   _     \
                        //    / \ / \ / \ / \ / \ / \ / \     \
                       // Ⓐ  ( E ) X ) P ) E ) R ) M ) S )  Ⓐ  \ 
                      //  __  \_/ \_/ \_/ \_/ \_/ \_/ \_/   __  \
                     // //  \                             //  \  \
                    // //    \  //\  //\  //\  //\  //\  //    \  \
                    \_//      \//  \//  \//  \//  \//  \//      \_//

                                   version 0.5 - 2013

                              Distributed under the GNU GPL
                         http://www.gnu.org/licenses/gpl-3.0.txt
                                Or see the file ./COPYING


==========
CONTENT:
==========
 - DESCRIPTION
 - DEPENDENCIES
 - USAGE
 - THE CONFIGURATION FILE
   - EXAMPLE
   - GENERAL SECTION
   - DEFAULT SECTION
   - DIRECTORY SECTION
 - RUNNING EXPERMS AS NON-ROOT USER
 - INOTIFY CONFIGURATION
 - FILES


========================================================================================
 ++ DESCRIPTION ++
========================================================================================
Runs as daemon and monitors file-changes happened in the directory set in experms.conf.
If changes happened, it adjusts the file-permissions and ownership/group.
You can either define one directory, or several sub-directories with different
ownerships and permissions.
Further it is able to restore all the ownerships and permissions of all files based on
the config-file.


========================================================================================
 ++ DEPENDENCIES ++
========================================================================================
experms depends on:

 - python2
 - python2-pyinotify (name can vary on different Linux distributions)


========================================================================================
 ++ USAGE ++
========================================================================================
experms [ start | stop | restart | restore | status | log | err | dircount | (help|-h|--help) | foreground ]


      Explanation:

            start: Start Experms
             stop: Stop Experms
          restart: Restart Experms
          restore: Restore the ownership and permissions of all files in the monitored
                   directory
           status: Displays status and if available PID of Experms
              log: Display the log-entries in real-time
              err: Display the error-log-entries in real-time
         dircount: Displays the amount of directories being watched with actual
                   configuration. Useful to configure inotify
   help|-h|--help: Display a short help
       foreground: Start Experms in the foreground. Useful to test a configuration

NOTE: YOU NEED TO EDIT THE CONFIGURATION FILE BEFORE RUNNING EXPERMS THE FIRST TIME!


========================================================================================
 ++ THE CONFIGURATION FILE ++
========================================================================================
experms.conf is usually located under /etc/experms.conf. If using
experms as non-root-user (see 'man experms'), it is recommended to  put
experms.conf in the home-directory. This is also possible as
/home/USER/.experms.conf.

If changes happened to experms.conf, it is necessary to restart
experms: 'experms restart'.

=========
EXAMPLE:
=========
#
# /etc/experms.conf
#

[general]
log_activities = no
restore = no

[default]
chmodd = 755

[directory_1]
path = /first/directory
user = first-user
group = first-group
chmodf = 640
chmodd = 750
excludepath = /first/directory/exclude1,/first/directory/subdir/exclude2

[directory_2]
path = /second/directory
group = second-group
chmodf = 0644
excludepattern = .txt|.TXT|.sh|.SH

=================
GENERAL SECTION:
=================
log_activities = yes | no
   Decide, if experms should write a log-file. If yes, the log will be
   stored in the directory, where experms lies. It also can be
   accessed with 'experms log'.

restore = yes | no
   Decide, if experms should restore all the rules on all configured
   files at start, in case there were changes while experms was not
   running.

=================
DEFAULT SECTION:
=================
Rules that should apply to all directory sections. They can be over‐
written inside a directory section.

===================
DIRECTORY SECTION:
===================
path = /path/to/watch/dir
   Set the directory where your rules should apply.

owner = username
   Set the owner of all the files and directories.

group = groupname
   Set the group of all the files and directories.

chmodf = octal permissions
   Set the permission of all the files.

chmodd = octal permissions
   Set the permission of all the directories.

excludepath = /path/to/exclude/dir,/path/to/exclude/file...
   Exclude some directories and files from the rules (comma  seperated).

excludepattern = regular expression
   Exclude files (and only files) based on a pattern.


========================================================================================
 ++ RUNNING EXPERMS AS NON-ROOT USER ++
========================================================================================
It's possible to run Experms as non-root user. But there are quiet a few restictions:

 - Only root is able to change the owner of a file.
 - Only the owner of a file or root is able to change the group of a file.
 - Only the owner of a file or root is able to change the permissions of a file.

If you want to run Experms as non-root user, make sure you are the owner of all
monitored files.

NOTE: If a file is modified by another user, it maybe changes it's ownership.
      In this case, Experms would print a message to the error-log if executed as
      non\-root user.

If you want to use Experms as non\-root user, is it recommended to make a copy of 
experms.conf in your home-directory. It is also possible to hide the file
(.experms.conf).


========================================================================================
 ++ INOTIFY CONFIGURATION ++
========================================================================================
Experms uses inotify to monitor the directories.
Inotify allows only a limited number of directories to watch per user.
Per default this is set to 8192.
You can increase this number by writing to /proc/sys/fs/inotify/max_user_watches
You can check the amount of directories recursively with:

'experms dircount'


========================================================================================
 ++ FILES ++
========================================================================================
For the moment all the related files lie in the directory of the scripts itself.

Exceptions:
/etc/experms.conf
/tmp/experms.pid
/usr/share/man/man1/experms.1.gz

If executed as root, the scripts as well as the config-file should remain writable
only for root.

List of files:

./experms
/etc/experms.conf
./check_config.py
./daemon.py
/usr/share/man/man1/experms.1.gz
./COPYING
./README
./CHANGELOG

If Experms was running at least once:

./experms.err
./experms.log

While Experms is running:

/tmp/experms.pid

